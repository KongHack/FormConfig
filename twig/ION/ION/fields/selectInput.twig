{% macro render(field, optOverride) %}
    <ion-text id="display-{{ field.getName() }}"><i>No option picked</i></ion-text>

    <script>
        $(function () {
            window.ACE.__FORMS.addon_changes['{{ field.getName() }}'] = "{{ field.getValue()|raw }}";
        });

        {% set selectedIndex = 0 %}
        {% set selectedText = "" %}
        {% set i = 0 %}
        var columnOpts = [];

        {% for key,val in optOverride ?? field.getOptions() %}
            columnOpts.push({
                value: "{{ key }}",
                text: "{{ val }}"
            });
            {% if key == field.getValue() %}
                {% set selectedIndex = i %}
                {% set selectedText = val %}
            {% endif %}

            {% set i = i + 1 %}
        {% endfor %}

        {% if field.getValue() is not empty %}
            $('#display-{{ field.getName() }}').html("{{ selectedText|e('js')|raw }}");
        {% endif %}


        $(document).on('click.field_{{ field.getName() }}', '#item-{{ field.getName() }}', function() {
            window.ACE.Ion.GeneratePicker({
                columns: [
                    {
                        name: "{{ field.getName() }}",
                        options: columnOpts,
                        selectedIndex: {{ selectedIndex }}
                    }
                ],
                buttons: [
                    {
                        text: "Cancel",
                        role: 'cancel'
                    },
                    {
                        text: "Done",
                        role: "confirm",
                        handler: function(d) {
                            for (var k in d) {
                                if (!d.hasOwnProperty(k)) {
                                    continue;
                                }
                                if (!window.ACE.__FORMS.addon_changes.hasOwnProperty(k)) {
                                    continue;
                                }
                                window.ACE.__FORMS.allowSave();
                                $('#display-{{ field.getName() }}').html(d[k]["text"]);
                                window.ACE.__FORMS.addon_changes[k] = d[k]["value"];
                            }
                        }
                    }
                ]
            });
        });
    </script>
{% endmacro %}